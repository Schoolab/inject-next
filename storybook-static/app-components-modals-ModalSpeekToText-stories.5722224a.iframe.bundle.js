"use strict";(self.webpackChunk_schoolab_inject_next=self.webpackChunk_schoolab_inject_next||[]).push([[8676],{"./src/app/components/modals/ModalSpeekToText.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{SpeekToText:()=>SpeekToText,__namedExportsOrder:()=>__namedExportsOrder,default:()=>ModalSpeekToText_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js");const speekToText=()=>{$((function(){let mediaRecorder,audioBlob,audioCtx,analyser,source,dataArray,animationId,timerInterval,audioChunks=[],secondsElapsed=0;const stopBtn=document.getElementById("stopBtn"),recordBtn=document.getElementById("recordBtn"),reRecordBtn=document.getElementById("reRecordBtn"),downloadBtn=document.getElementById("downloadBtn"),recaller=document.getElementById("recaller"),player=document.getElementById("player"),canvas=document.getElementById("visualizer"),ctx=canvas.getContext("2d"),timerDiv=document.getElementById("timer");let history=[];const BAR_WIDTH=2,BAR_SPACING=2;function resizeCanvas(){const newWidth=canvas.clientWidth,newHeight=canvas.clientHeight;canvas.width=newWidth,canvas.height=newHeight;const newLength=Math.floor(canvas.width/(BAR_WIDTH+BAR_SPACING));history=new Array(newLength).fill(0),ctx.clearRect(0,0,canvas.width,canvas.height)}function updateTimer(){const min=Math.floor(secondsElapsed/60),sec=secondsElapsed%60;timerDiv.textContent=`${min}:${sec.toString().padStart(2,"0")}`}function blobToWav(chunks){const buffer=new Blob(chunks,{type:"audio/webm"});return new Promise((resolve=>{const reader=new FileReader;reader.onload=()=>{const arrayBuffer=reader.result;(new(window.AudioContext||window.webkitAudioContext)).decodeAudioData(arrayBuffer,(audioBuffer=>{const wavBuffer=function audioBufferToWav(buffer){const numChannels=buffer.numberOfChannels,sampleRate=buffer.sampleRate,length=buffer.length*numChannels*2+44,arrayBuffer=new ArrayBuffer(length),view=new DataView(arrayBuffer);let offset=0;function writeString(str){for(let i=0;i<str.length;i++)view.setUint8(offset++,str.charCodeAt(i))}function setUint16(val){view.setUint16(offset,val,!0),offset+=2}function setUint32(val){view.setUint32(offset,val,!0),offset+=4}writeString("RIFF"),setUint32(length-8),writeString("WAVE"),writeString("fmt "),setUint32(16),setUint16(1),setUint16(numChannels),setUint32(sampleRate),setUint32(sampleRate*numChannels*2),setUint16(2*numChannels),setUint16(16),writeString("data"),setUint32(buffer.length*numChannels*2);for(let i=0;i<buffer.length;i++)for(let ch=0;ch<numChannels;ch++){let sample=buffer.getChannelData(ch)[i];sample=Math.max(-1,Math.min(1,sample)),view.setInt16(offset,sample<0?32768*sample:32767*sample,!0),offset+=2}return arrayBuffer}(audioBuffer),wavBlob=new Blob([wavBuffer],{type:"audio/wav"});resolve(wavBlob)}))},reader.readAsArrayBuffer(buffer)}))}async function startRecording(){const stream=await navigator.mediaDevices.getUserMedia({audio:!0});mediaRecorder=new MediaRecorder(stream),audioChunks=[],secondsElapsed=0,updateTimer(),reRecordBtn.disabled=!0,downloadBtn.disabled=!0,stopBtn.disabled=!1,mediaRecorder.ondataavailable=e=>audioChunks.push(e.data),mediaRecorder.onstop=async()=>{audioBlob=await blobToWav(audioChunks);const audioUrl=URL.createObjectURL(audioBlob);player.src=audioUrl,recaller.classList.remove("d-flex"),recaller.classList.add("d-none"),player.classList.remove("d-none"),player.classList.add("d-block"),reRecordBtn.disabled=!1,downloadBtn.disabled=!1,clearInterval(timerInterval),secondsElapsed=0,updateTimer()},mediaRecorder.start(),timerInterval=setInterval((()=>{secondsElapsed++,updateTimer(),secondsElapsed>=30&&"recording"===mediaRecorder.state&&mediaRecorder.stop()}),1e3),audioCtx=new(window.AudioContext||window.webkitAudioContext),"suspended"===audioCtx.state&&await audioCtx.resume(),analyser=audioCtx.createAnalyser(),source=audioCtx.createMediaStreamSource(stream),source.connect(analyser),analyser.fftSize=256,dataArray=new Uint8Array(analyser.frequencyBinCount),animationId&&cancelAnimationFrame(animationId);let frame=0;!function draw(){if(animationId=requestAnimationFrame(draw),analyser.getByteFrequencyData(dataArray),frame%4==0){const barHeight=dataArray.reduce(((a,b)=>a+b),0)/dataArray.length/255*canvas.height*5;history.shift(),history.push(barHeight)}frame++,function drawBars(){ctx.clearRect(0,0,canvas.width,canvas.height);const centerY=canvas.height/2;for(let i=0;i<history.length;i++){const h=history[i];ctx.fillStyle="#000000",ctx.fillRect(i*(BAR_WIDTH+BAR_SPACING),centerY-h/2,BAR_WIDTH,h)}}()}()}window.addEventListener("load",resizeCanvas),window.addEventListener("resize",resizeCanvas),window.addEventListener("load",startRecording),recordBtn.addEventListener("click",(async()=>{stopBtn.disabled=!1,reRecordBtn.disabled=!0,downloadBtn.disabled=!0,resizeCanvas(),secondsElapsed=0,updateTimer(),await startRecording()})),stopBtn.addEventListener("click",(async()=>{mediaRecorder&&"recording"===mediaRecorder.state&&(mediaRecorder.stop(),stopBtn.disabled=!0,cancelAnimationFrame(animationId),audioCtx&&audioCtx.close(),clearInterval(timerInterval),secondsElapsed=0,updateTimer())})),reRecordBtn.addEventListener("click",(async()=>{recaller.classList.remove("d-none"),recaller.classList.add("d-flex"),player.classList.remove("d-block"),player.classList.add("d-none"),stopBtn.disabled=!1,reRecordBtn.disabled=!0,downloadBtn.disabled=!0,resizeCanvas(),secondsElapsed=0,updateTimer(),await startRecording()})),downloadBtn.addEventListener("click",(()=>{if(!audioBlob)return;const url=URL.createObjectURL(audioBlob),a=document.createElement("a");a.href=url,a.download="enregistrement.wav",document.body.appendChild(a),a.click(),document.body.removeChild(a)}))}))},ModalSpeekToText=({})=>((0,react.useEffect)((()=>{speekToText()}),[]),(0,jsx_runtime.jsx)("div",{className:"modal-dialog  modal-dialog-centered modal-dialog-scrollable",role:"document",children:(0,jsx_runtime.jsxs)("div",{className:"modal-content",children:[(0,jsx_runtime.jsxs)("div",{className:"modal-header border-bottom",children:[(0,jsx_runtime.jsx)("h3",{className:"modal-title line-clamp-1",children:(0,jsx_runtime.jsx)("span",{className:"text-truncate",children:"Ask AI"})}),(0,jsx_runtime.jsx)("div",{className:"modal-actions",children:(0,jsx_runtime.jsx)("button",{className:"btn btn-transparent border-0 p-2xs text-muted",type:"button","data-dismiss":"modal","aria-label":"Close",children:(0,jsx_runtime.jsx)("span",{className:"icon icon-close is-24px","aria-hidden":"true"})})})]}),(0,jsx_runtime.jsxs)("div",{className:"modal-body d-flex flex-column gap-sm",children:[(0,jsx_runtime.jsx)("div",{className:"d-flex flex-column",children:(0,jsx_runtime.jsx)("span",{className:"label mb-0",children:"Transcribe voice"})}),(0,jsx_runtime.jsxs)("div",{id:"recaller",className:"bg-highlight rounded-pill px-md d-flex align-items-center w-100 gap-md",children:[(0,jsx_runtime.jsx)("div",{className:"small text-muted",id:"timer",children:"0:00"}),(0,jsx_runtime.jsx)("canvas",{className:"flex-fill",id:"visualizer",style:{height:"54px"}}),(0,jsx_runtime.jsxs)("div",{className:"d-flex gap-2xs",children:[(0,jsx_runtime.jsx)("button",{id:"recordBtn",className:"btn  btn-sm btn-transparent",title:"Record",children:(0,jsx_runtime.jsx)("span",{className:"icon icon-micro"})}),(0,jsx_runtime.jsx)("button",{id:"stopBtn",className:"btn  btn-sm btn-transparent",title:"ArrÃªter",children:(0,jsx_runtime.jsx)("span",{className:"icon icon-check"})})]})]}),(0,jsx_runtime.jsx)("audio",{id:"player",controls:!0,className:"bg-highlight rounded-pill  w-100 d-none"})]}),(0,jsx_runtime.jsxs)("div",{className:"modal-footer border-top",children:[(0,jsx_runtime.jsx)("button",{className:"btn btn-lg btn-default","data-dismiss":"modal",children:"Cancel"}),(0,jsx_runtime.jsxs)("div",{className:"d-flex gap-xs ml-auto",children:[(0,jsx_runtime.jsx)("button",{id:"reRecordBtn",className:"btn btn-lg btn-default reloadBtn",title:"Regenerate",children:(0,jsx_runtime.jsx)("span",{className:"icon icon-reload"})}),(0,jsx_runtime.jsx)("button",{id:"downloadBtn",className:"btn btn-lg btn-primary applyBtn",children:(0,jsx_runtime.jsx)("span",{children:"Apply"})})]})]})]})}));ModalSpeekToText.__docgenInfo={description:"",methods:[],displayName:"ModalSpeekToText"};const ModalSpeekToText_stories={title:"Components/Modals/SpeekToText",component:ModalSpeekToText,parameters:{layout:"fullscreen"}},SpeekToText={},__namedExportsOrder=["SpeekToText"];SpeekToText.parameters={...SpeekToText.parameters,docs:{...SpeekToText.parameters?.docs,source:{originalSource:"{}",...SpeekToText.parameters?.docs?.source}}}}}]);